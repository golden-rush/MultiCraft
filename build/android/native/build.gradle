apply plugin: 'com.android.library'
import org.ajoberstar.grgit.Grgit

android {
	compileSdkVersion 29
	buildToolsVersion '29.0.2'
	defaultConfig {
		minSdkVersion 16
		targetSdkVersion 29
		externalNativeBuild {
			ndkBuild {
				arguments '-j',
						'APP_STL=c++_static',
						'COMPILER_VERSION=clang',
						'APP_SHORT_COMMANDS=true'
			}
		}
	}

	externalNativeBuild {
		ndkBuild {
			path file('jni/Android.mk')
		}
	}

	// supported architectures
	splits {
		abi {
			enable true
			reset()
			include 'armeabi-v7a', 'arm64-v8a'//, 'x86'
		}
	}

signingConfigs {
    release {
      storeFile file("/home/parallels/Keystore/craft.jks")
      storePassword "666666"
      keyAlias "easycraft"
      keyPassword "666666"
    }
  }

	buildTypes {
		release {
			externalNativeBuild {
				ndkBuild {
					arguments 'NDEBUG=1'
				}
			}
			signingConfig signingConfigs.release
		}
	}
}

task cloneGitRepo() {
	def destination = file('deps')
	if(!destination.exists()) {
		def grgit = Grgit.clone(
				dir: destination,
				uri: 'https://github.com/MultiCraft/deps'
		)
		grgit.close()
	}
}

preBuild.dependsOn cloneGitRepo
